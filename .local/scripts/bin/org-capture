#!/bin/dash

# Taken from Doom Emacs
#
# Open an org-capture popup frame from the shell. This opens a temporary emacs
# daemon if emacs isn't already running.
#
# Usage: org-capture
# Examples:
#   org-capture

set -e

cleanup() {
  emacsclient --eval '(let (kill-emacs-hook) (kill-emacs))'
}

# If emacs isn't running, we start a temporary daemon, solely for this window.
if ! emacsclient --suppress-output --eval nil; then
  emacs --daemon
  trap cleanup EXIT INT TERM
fi

frame_name="capture"

emacsclient -a "" \
  -c -F "((name . \"$frame_name\") (width . 99) (height . 40) (transient . t))" \
  -e "(my/org-capture-open-frame \"$frame_name\")"
