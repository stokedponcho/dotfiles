#!/bin/dash

url="$1"
id=$(xdotool search --name "Tor Browser" 2> /dev/null)

if [ -z "$id" ]; then
  if [ -z "$url" ]; then
    torbrowser-launcher
  else
    "${XDG_DATA_DIR:-$HOME/.local/share}/torbrowser/tbb/x86_64/tor-browser_en-US/Browser/start-tor-browser"  "$url"
  fi
else
  # needed when triggering the script from newsboat, will not open tab otherwise
  sleep 0.1
  xdotool windowactivate $id
  xdotool key --window $id --clearmodifiers Ctrl+t
  xdotool key --window $id --clearmodifiers Ctrl+L
  xdotool type --window $id "$url"
  xdotool key --window $id --clearmodifiers Return
fi
